<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brutal Pusher - Stop Procrastinating!</title>
    <meta name="description" content="A brutal but humorous anti-procrastination tool">
    <meta name="theme-color" content="#dc2626">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Generative AI -->
    <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai@0.2.1/dist/generative-ai.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        .brutal-button {
            @apply bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg 
                   transform hover:scale-105 transition-all duration-200 shadow-lg;
        }
        
        .brutal-card {
            @apply bg-white rounded-xl shadow-lg border-2 border-orange-500 p-6;
        }
        
        .brutal-text {
            @apply text-red-600 font-bold text-lg;
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .pulse-brutal {
            animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #fef2f2 0%, #fed7aa 100%);
        }
        
        .step-item {
            @apply flex items-start gap-3 p-3 bg-orange-50 rounded-lg cursor-pointer transition-colors;
        }
        
        .step-item.completed {
            @apply bg-green-50 border-2 border-green-200;
        }
        
        .step-item:hover {
            @apply bg-orange-100;
        }

        .loading {
            @apply animate-pulse;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-red-600 mb-2">
                üíÄ Brutal Pusher üíÄ
            </h1>
            <p class="text-gray-600">Stop procrastinating, you lazy potato! ü•î</p>
        </header>

        <!-- Main Content -->
        <main class="max-w-2xl mx-auto">
            <!-- Step 1: Task Input -->
            <div id="taskStep" class="brutal-card">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">üéØ</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">
                        What do you want to accomplish?
                    </h2>
                    <p class="text-gray-600">
                        Tell me what you're procrastinating on, you magnificent slacker! üò§
                    </p>
                </div>

                <form id="taskForm" class="space-y-4">
                    <div>
                        <textarea
                            id="taskInput"
                            placeholder="I want to... (be specific, you lazy human!)"
                            class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none resize-none"
                            rows="4"
                            required
                        ></textarea>
                    </div>
                    
                    <button
                        type="submit"
                        id="submitBtn"
                        class="brutal-button w-full flex items-center justify-center gap-2"
                    >
                        <span id="submitText">‚ö° Break it down, you procrastinator!</span>
                        <span id="loadingText" class="hidden">ü§ñ AI is thinking...</span>
                    </button>
                </form>
            </div>

            <!-- Step 2: AI Generated Plan -->
            <div id="planStep" class="space-y-6 hidden">
                <div class="brutal-card">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white text-2xl">üî•</span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">
                            Your Brutal Action Plan
                        </h2>
                    </div>
                    
                    <div id="motivationText" class="bg-red-50 border-2 border-red-600 rounded-lg p-4 mb-4">
                        <p class="text-lg font-semibold text-red-600 leading-relaxed">
                            <!-- Motivation will be populated by AI -->
                        </p>
                    </div>

                    <button
                        id="startWorkingBtn"
                        class="brutal-button w-full flex items-center justify-center gap-2"
                    >
                        ‚è∞ Start working, you lazy human!
                    </button>
                </div>

                <div class="brutal-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="text-orange-500">‚úÖ</span>
                        Your Custom Action Plan
                    </h3>
                    
                    <div id="breakdownList" class="space-y-3">
                        <!-- Steps will be populated by AI -->
                    </div>
                </div>
            </div>

            <!-- Step 3: Progress Tracker -->
            <div id="progressStep" class="space-y-6 hidden">
                <div class="brutal-card">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white text-2xl">üèÜ</span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">
                            Progress Tracker
                        </h2>
                        <p class="text-gray-600">Don't stop now, you're doing great! üí™</p>
                    </div>

                    <div class="space-y-4">
                        <div class="text-center">
                            <div id="timer" class="text-3xl font-bold text-red-600 mb-2">
                                00:00:00
                            </div>
                            <p class="text-gray-600">Time spent working</p>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>Progress</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div 
                                    id="progressBar"
                                    class="bg-red-600 h-2 rounded-full transition-all duration-300"
                                    style="width: 0%"
                                ></div>
                            </div>
                        </div>

                        <div class="flex gap-2">
                            <button
                                id="pauseBtn"
                                class="flex-1 brutal-button"
                            >
                                ‚è∏Ô∏è Pause
                            </button>
                            <button
                                id="restartBtn"
                                class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
                            >
                                üîÑ New Task
                            </button>
                        </div>
                    </div>
                </div>

                <div class="brutal-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Your Steps</h3>
                    <div id="progressSteps" class="space-y-3">
                        <!-- Progress steps will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Global state
        let currentStep = 'task';
        let taskData = {
            task: '',
            breakdown: [],
            motivation: ''
        };
        let timer = null;
        let timeElapsed = 0;
        let isTimerRunning = true;
        let completedSteps = [];

        // Initialize Gemini AI
        let genAI;
        
        // Debug function
        function debug(message) {
            console.log('üîç Debug:', message);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            debug('App initialized');
            setupEventListeners();
            initializeAI();
            debug('Setup complete');
        });

        function initializeAI() {
            try {
                // Check if Gemini API key is available
                const apiKey = prompt('Please enter your Gemini API key (or press Cancel to use demo mode):');
                if (apiKey && apiKey.trim()) {
                    genAI = window.generativeAI.GoogleGenerativeAI(apiKey);
                    debug('Gemini AI initialized with API key');
                } else {
                    debug('Using demo mode - no API key provided');
                }
            } catch (error) {
                console.error('Error initializing AI:', error);
                debug('Using demo mode due to error');
            }
        }

        function setupEventListeners() {
            debug('Setting up event listeners');
            
            // Task form
            const taskForm = document.getElementById('taskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', function(e) {
                    debug('Task form submitted');
                    handleTaskSubmit(e);
                });
            } else {
                console.error('‚ùå taskForm not found!');
            }
            
            // Start working button
            const startWorkingBtn = document.getElementById('startWorkingBtn');
            if (startWorkingBtn) {
                startWorkingBtn.addEventListener('click', function() {
                    debug('Start working button clicked');
                    startProgress();
                });
            } else {
                console.error('‚ùå startWorkingBtn not found!');
            }
            
            // Progress controls
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) {
                pauseBtn.addEventListener('click', function() {
                    debug('Pause button clicked');
                    toggleTimer();
                });
            } else {
                console.error('‚ùå pauseBtn not found!');
            }
            
            const restartBtn = document.getElementById('restartBtn');
            if (restartBtn) {
                restartBtn.addEventListener('click', function() {
                    debug('Restart button clicked');
                    restartApp();
                });
            } else {
                console.error('‚ùå restartBtn not found!');
            }
            
            debug('Event listeners setup complete');
        }

        function handleTaskSubmit(e) {
            e.preventDefault();
            debug('Handling task submit');
            
            const taskInput = document.getElementById('taskInput');
            if (!taskInput) {
                console.error('‚ùå taskInput not found!');
                return;
            }
            
            const task = taskInput.value.trim();
            debug('Task entered: ' + task);
            
            if (task) {
                taskData.task = task;
                showLoading(true);
                generateAIPlan(task);
            } else {
                debug('No task entered');
                alert('Come on, you lazy potato! Enter something! ü•î');
            }
        }

        function showLoading(show) {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingText = document.getElementById('loadingText');
            
            if (show) {
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                loadingText.classList.remove('hidden');
                submitBtn.classList.add('loading');
            } else {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
                submitBtn.classList.remove('loading');
            }
        }

        async function generateAIPlan(task) {
            debug('Generating AI plan for: ' + task);
            
            try {
                if (genAI) {
                    // Use real Gemini API
                    await generateWithGemini(task);
                } else {
                    // Use demo mode
                    generateDemoPlan(task);
                }
            } catch (error) {
                console.error('Error generating plan:', error);
                generateDemoPlan(task);
            }
        }

        async function generateWithGemini(task) {
            try {
                const model = genAI.getGenerativeModel({ model: "gemini-pro" });
                
                const prompt = `You are a brutal but humorous motivational coach. The user wants to accomplish: "${task}"

Please provide:
1. A brutal but funny motivational message (2-3 sentences, use emojis)
2. A custom action plan with 4-6 specific, actionable steps

Format your response as JSON:
{
  "motivation": "your motivational message here",
  "steps": ["step 1", "step 2", "step 3", "step 4"]
}

Be specific to their task, not generic. Make the motivation brutal but humorous, not mean.`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                
                debug('AI Response: ' + text);
                
                // Try to parse JSON response
                try {
                    const parsed = JSON.parse(text);
                    taskData.motivation = parsed.motivation;
                    taskData.breakdown = parsed.steps;
                } catch (parseError) {
                    // If JSON parsing fails, extract from text
                    extractFromText(text);
                }
                
                showPlan();
                
            } catch (error) {
                console.error('Gemini API error:', error);
                generateDemoPlan(task);
            }
        }

        function extractFromText(text) {
            // Fallback: extract motivation and steps from text
            const lines = text.split('\n').filter(line => line.trim());
            
            // First line is usually motivation
            taskData.motivation = lines[0] || "Time to stop being a lazy potato and get things done! üíÄ";
            
            // Rest are steps
            taskData.breakdown = lines.slice(1).filter(line => 
                line.trim() && !line.includes('{') && !line.includes('}')
            ).map(line => line.replace(/^\d+\.\s*/, '').trim());
            
            if (taskData.breakdown.length === 0) {
                taskData.breakdown = generateDefaultSteps(taskData.task);
            }
        }

        function generateDemoPlan(task) {
            debug('Generating demo plan');
            
            // Generate brutal motivation
            const motivations = [
                `Listen here, you magnificent procrastinator! Your ${task} isn't going to do itself! Stop being a professional excuse maker and start being a goal achiever! üíÄ`,
                `Oh, you want to ${task}? Well, your future self is already disappointed in you! Time to stop being a couch potato and start being a success potato! üöÄ`,
                `Your ${task} is waiting for you, but you're too busy being lazy! Your procrastination skills are impressive, but your achievement skills are non-existent! Time to change that! ‚ö°`,
                `Excuse me, but your ${task} doesn't care about your feelings! Stop making excuses and start making progress! Your goals are getting tired of waiting! ü•î`
            ];
            
            taskData.motivation = motivations[Math.floor(Math.random() * motivations.length)];
            
            // Generate custom steps based on task
            taskData.breakdown = generateCustomSteps(task);
            
            showPlan();
        }

        function generateCustomSteps(task) {
            const taskLower = task.toLowerCase();
            
            if (taskLower.includes('study') || taskLower.includes('learn') || taskLower.includes('read')) {
                return [
                    'Clear your desk and remove all distractions',
                    'Open your textbook and read one chapter',
                    'Take notes on the key points',
                    'Review and summarize what you learned',
                    'Test yourself with practice questions'
                ];
            } else if (taskLower.includes('work') || taskLower.includes('project') || taskLower.includes('job')) {
                return [
                    'Check your email and prioritize tasks',
                    'Start with the most important task first',
                    'Set a timer for 25 minutes and focus',
                    'Take a 5-minute break, then continue',
                    'Review your progress and adjust'
                ];
            } else if (taskLower.includes('exercise') || taskLower.includes('workout') || taskLower.includes('gym')) {
                return [
                    'Put on your workout clothes',
                    'Do a 5-minute warm-up',
                    'Start with 10 minutes of cardio',
                    'Add strength training exercises',
                    'Cool down and stretch'
                ];
            } else if (taskLower.includes('clean') || taskLower.includes('organize') || taskLower.includes('tidy')) {
                return [
                    'Pick up trash and put it in the bin',
                    'Put away items that are out of place',
                    'Wipe down surfaces with a cloth',
                    'Vacuum or sweep the floor',
                    'Organize one drawer or shelf'
                ];
            } else if (taskLower.includes('write') || taskLower.includes('blog') || taskLower.includes('article')) {
                return [
                    'Open a blank document',
                    'Write down your main ideas',
                    'Start with the first paragraph',
                    'Keep writing without editing',
                    'Review and polish your work'
                ];
            } else {
                return [
                    'Break down your task into smaller parts',
                    'Start with the easiest step first',
                    'Set a timer for 25 minutes and focus',
                    'Take a short break and continue',
                    'Review your progress and celebrate small wins'
                ];
            }
        }

        function showPlan() {
            debug('Showing plan');
            showLoading(false);
            showStep('plan');
            displayMotivation();
            displayBreakdown();
        }

        function displayMotivation() {
            debug('Displaying motivation');
            const motivationText = document.getElementById('motivationText');
            if (!motivationText) {
                console.error('‚ùå motivationText not found!');
                return;
            }
            
            motivationText.innerHTML = `<p class="text-lg font-semibold text-red-600 leading-relaxed">${taskData.motivation}</p>`;
            debug('Motivation displayed');
        }

        function displayBreakdown() {
            debug('Displaying breakdown');
            const breakdownList = document.getElementById('breakdownList');
            if (!breakdownList) {
                console.error('‚ùå breakdownList not found!');
                return;
            }
            
            breakdownList.innerHTML = '';
            
            taskData.breakdown.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'flex items-start gap-3 p-3 bg-orange-50 rounded-lg';
                stepDiv.innerHTML = `
                    <span class="bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
                        ${index + 1}
                    </span>
                    <p class="text-gray-700">${step}</p>
                `;
                breakdownList.appendChild(stepDiv);
            });
            debug('Breakdown displayed: ' + taskData.breakdown.length + ' steps');
        }

        function startProgress() {
            debug('Starting progress');
            showStep('progress');
            startTimer();
            displayProgressSteps();
        }

        function startTimer() {
            debug('Starting timer');
            timer = setInterval(() => {
                if (isTimerRunning) {
                    timeElapsed++;
                    updateTimer();
                }
            }, 1000);
        }

        function updateTimer() {
            const hours = Math.floor(timeElapsed / 3600);
            const minutes = Math.floor((timeElapsed % 3600) / 60);
            const seconds = timeElapsed % 60;
            
            const timerElement = document.getElementById('timer');
            if (timerElement) {
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function toggleTimer() {
            isTimerRunning = !isTimerRunning;
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) {
                pauseBtn.innerHTML = isTimerRunning ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Resume';
            }
            debug('Timer toggled: ' + (isTimerRunning ? 'running' : 'paused'));
        }

        function displayProgressSteps() {
            debug('Displaying progress steps');
            const progressSteps = document.getElementById('progressSteps');
            if (!progressSteps) {
                console.error('‚ùå progressSteps not found!');
                return;
            }
            
            progressSteps.innerHTML = '';
            
            taskData.breakdown.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-item';
                stepDiv.onclick = () => {
                    debug('Step clicked: ' + index);
                    toggleStep(index);
                };
                stepDiv.innerHTML = `
                    <span class="text-gray-400 text-xl">‚úÖ</span>
                    <span>${step}</span>
                `;
                progressSteps.appendChild(stepDiv);
            });
            debug('Progress steps displayed');
        }

        function toggleStep(index) {
            debug('Toggling step: ' + index);
            const stepItems = document.querySelectorAll('.step-item');
            const stepItem = stepItems[index];
            
            if (completedSteps.includes(index)) {
                completedSteps = completedSteps.filter(i => i !== index);
                stepItem.classList.remove('completed');
                stepItem.querySelector('span').className = 'text-gray-400 text-xl';
                debug('Step uncompleted: ' + index);
            } else {
                completedSteps.push(index);
                stepItem.classList.add('completed');
                stepItem.querySelector('span').className = 'text-green-600 text-xl';
                debug('Step completed: ' + index);
            }
            
            updateProgress();
        }

        function updateProgress() {
            const progress = taskData.breakdown.length > 0 ? (completedSteps.length / taskData.breakdown.length) * 100 : 0;
            
            const progressPercent = document.getElementById('progressPercent');
            if (progressPercent) {
                progressPercent.textContent = `${Math.round(progress)}%`;
            }
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
            
            debug('Progress updated: ' + Math.round(progress) + '%');
        }

        function restartApp() {
            debug('Restarting app');
            if (timer) {
                clearInterval(timer);
            }
            
            // Reset state
            currentStep = 'task';
            taskData = { task: '', breakdown: [], motivation: '' };
            timeElapsed = 0;
            isTimerRunning = true;
            completedSteps = [];
            
            // Reset UI
            const taskInput = document.getElementById('taskInput');
            if (taskInput) taskInput.value = '';
            
            const timerElement = document.getElementById('timer');
            if (timerElement) timerElement.textContent = '00:00:00';
            
            const progressPercent = document.getElementById('progressPercent');
            if (progressPercent) progressPercent.textContent = '0%';
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) progressBar.style.width = '0%';
            
            showStep('task');
            debug('App restarted');
        }

        function showStep(step) {
            debug('Showing step: ' + step);
            
            // Hide all steps
            const steps = ['task', 'plan', 'progress'];
            steps.forEach(stepName => {
                const stepElement = document.getElementById(stepName + 'Step');
                if (stepElement) {
                    stepElement.classList.add('hidden');
                }
            });
            
            // Show current step
            const currentStepElement = document.getElementById(step + 'Step');
            if (currentStepElement) {
                currentStepElement.classList.remove('hidden');
                currentStep = step;
                debug('Step shown: ' + step);
            } else {
                console.error('‚ùå Step element not found: ' + step + 'Step');
            }
        }

        // Add some helpful console messages
        console.log('üíÄ Brutal Pusher loaded!');
        console.log('üîç Open browser console (F12) to see debug messages');
        console.log('üì± This is a PWA - you can install it on your phone!');
        console.log('ü§ñ AI-powered task breakdown - enter your Gemini API key when prompted');
    </script>
</body>
</html>
